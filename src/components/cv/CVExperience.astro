---
import type { ResponseWithEncoding } from 'node_modules/astro/dist/core/endpoint';
import { defineScriptVars } from 'astro/compiler-runtime';
import Steps from '~/components/widgets/Steps.astro';
import { experience } from '~/content/cv/experience';

const { cv } = Astro.props;

const formatExpItems = (cv) => {
  let items = [];

  for (const row of experience) {
    let title = `${row.title}<br/><span class="font-normal">${row.company}<span class="text-sm"> | ${row.location}</span></span><br/><span class="text-sm font-normal">${row.date}</span>`;
    let desc = `<span class="text-black" >${row.description}</span>`;

    desc += '<ul class="list-disc mt-4 ml-4">';
    for (const ac of row.accomplishments) {
      if (ac.cv.indexOf(cv) > -1) {
        desc += `<li class="mt-4">${ac.desc}</li>`;
      }
    }
    desc += `</ul>`;

    if (row.cases) {
      desc += '<footer class="mt-5"><ul class="text-sm">';
      for (const cs of row.cases) {
        desc += `<li class="bg-gray-100 dark:bg-slate-700 inline-block mr-2 rtl:mr-0 rtl:ml-2 mb-2 py-0.5 px-2 lowercase font-medium">`;
        if (cs.link) {
          desc += `<a href=${row.link} class="text-muted dark:text-slate-300 hover:text-primary dark:hover:text-gray-200">${cs.name}</a>`;
        } else {
          desc += `<span class="text-muted">${cs.name}</span>`;
        }
        desc += `</li>`;
      }
      desc += '</ul></footer>';
    }

    items.push({ title, description: desc, icon: 'tabler:briefcase' });
  }

  return items;
};
---

<section id="experience">
  <Steps id="experience-widget-1" title="Professional Experience" items={formatExpItems(cv)} />
</section>
